<%- include('partials/header') %>

<div class="form-section">
  <h2><i class="fa-solid fa-plus"></i> Adicionar Nova CompetÃªncia</h2>
  <form action="/competencias" method="POST">
    <input type="text" name="habilidade" placeholder="Habilidade (ex: Java, React, SQL)" required>

    <select name="nivel" required>
      <option value="" disabled selected>-- Selecione o NÃ­vel --</option>
      <option value="Iniciante">Iniciante</option>
      <option value="BÃ¡sico">BÃ¡sico</option>
      <option value="IntermediÃ¡rio">IntermediÃ¡rio</option>
      <option value="AvanÃ§ado">AvanÃ§ado</option>
      <option value="Especialista">Especialista</option>
    </select>

    <button type="submit">Adicionar CompetÃªncia</button>
  </form>
</div>

<h2><i class="fa-solid fa-gears"></i> CompetÃªncias Cadastradas</h2>
<% if (competencias.length === 0) { %>
  <p>Nenhuma competÃªncia cadastrada.</p>
<% } else { %>
  <div class="card-grid">
    <% competencias.forEach(c => { %>
      <%
        // --- LÃ“GICA PARA MAPEAR NÃVEL PARA NÃšMERO DE ESTRELAS ---
        let estrelasPreenchidas = 0;
        switch (c.nivel) {
          case 'Iniciante': estrelasPreenchidas = 1; break;
          case 'BÃ¡sico': estrelasPreenchidas = 2; break;
          case 'IntermediÃ¡rio': estrelasPreenchidas = 3; break;
          case 'AvanÃ§ado': estrelasPreenchidas = 4; break;
          case 'Especialista': estrelasPreenchidas = 5; break;
        }
        const estrelasVazias = 5 - estrelasPreenchidas;
      %>
      <div class="card">
        <h3><%= c.habilidade %></h3>

        <div class="competency-level" title="NÃ­vel: <%= c.nivel %>">
          <% for(let i = 0; i < estrelasPreenchidas; i++) { %>
            <i class="fa-solid fa-star star-icon filled"></i>
          <% } %>
          <% for(let i = 0; i < estrelasVazias; i++) { %>
            <i class="fa-regular fa-star star-icon"></i>
          <% } %>
          <span class="level-text">(<%= c.nivel %>)</span> </div>

        <form action="/competencias/<%= c.id %>?_method=PUT" method="POST" style="margin-top: 20px;">
          <input type="text" name="habilidade" value="<%= c.habilidade %>">

          <select name="nivel" required>
            <option value="Iniciante" <%= c.nivel === 'Iniciante' ? 'selected' : '' %>>Iniciante</option>
            <option value="BÃ¡sico" <%= c.nivel === 'BÃ¡sico' ? 'selected' : '' %>>BÃ¡sico</option>
            <option value="IntermediÃ¡rio" <%= c.nivel === 'IntermediÃ¡rio' ? 'selected' : '' %>>IntermediÃ¡rio</option>
            <option value="AvanÃ§ado" <%= c.nivel === 'AvanÃ§ado' ? 'selected' : '' %>>AvanÃ§ado</option>
            <option value="Especialista" <%= c.nivel === 'Especialista' ? 'selected' : '' %>>Especialista</option>
          </select>

          <div class="card-actions">
              <button type="submit">âœï¸ Atualizar</button>
            </form>

            <form action="/competencias/<%= c.id %>?_method=DELETE" method="POST">
              <button type="submit" class="btn-delete" onclick="return confirm('Tem certeza?');">ğŸ—‘ï¸ Excluir</button>
            </form>
          </div>

        </div> <% }) %>
  </div> <% } %>

<%- include('partials/footer') %>